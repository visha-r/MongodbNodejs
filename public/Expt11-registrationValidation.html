<!DOCTYPE html>
<html>
<head>
    <title>Visha's Experiments</title>
    <script type="text/javascript" src="js/jquery-1.11.2.js"></script>
    <script type="text/javascript" src="js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="css/bootstrap.min.css" />
    <link rel="stylesheet" href="css/bootstrap-theme.css" />
    <script type="text/javascript" src="js/angular.js"></script>
    <script type="text/javascript" src="js/angular-route.min.js"></script>
    <script type="text/javascript" src="js/ui-bootstrap-tpls-0.12.1.js"></script>
    <script type="text/javascript" src="js/Expt11Controller.js"></script>
    <script type="text/javascript" src="js/NewProductService.js"></script>
    <script type="text/javascript" src="js/UserService.js"></script>
    <link rel="stylesheet" href="stylesheets/style.css" />
</head>	
<body ng-app="AngularApp">
    <div class="main-wrapper">
        <h1> Experiment 1 - Registration form validation </h1>
        <div class="demo-wrapper">
            <h2> Experiment to validate registration form </h2>
            <div class="instructions">
            <ul>
            <li> Navigate to registration form </li>
            <li> The system already has a user with username 'admin'. So if you choose admin
            as username it will throw error</li>
            <li> Also if the passwords don't match, it will throw error </li>
            <li> Fields marked with * if cleared after filling in some value, it will throw error</li>
            <li> Register button will not be enabled until all errors are cleared</li>
            </ul>
            </div>
            <div class="container">
        	<nav class="navbar navbar-inverse" ng-controller="MainController">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                        <span class="sr-only">Toggle navigation</span>                        
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <ul class="nav navbar-nav">
                        <li id="homelink"><a href="#/home">Home<span class="sr-only">(current)</span></a></li>
                        <li>
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Search by Category <b class="caret"></b></a>
                    <ul class="dropdown-menu multi-level">
                        
                        <li class="dropdown-submenu">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">Laptops</a>
                            <ul class="dropdown-menu">
                                <li><a href="#/search/MOBILE COMPUTING/Lenovo">Lenovo</a></li>
                                <li class="divider"></li>
                                <li ><a href="#/search/MOBILE COMPUTING/Samsung">Samsung</a></li>
                                 <li class="divider"></li>
                                 <li><a href="#/search/MOBILE COMPUTING/Dell">Dell</a></li>
                                 <li class="divider"></li>
                                 <li><a href="#/search/MOBILE COMPUTING/Acer">Acer</a></li>
                                 <li class="divider"></li>
                                 <li><a href="#/search/MOBILE COMPUTING/Asus">Asus</a></li>
                            </ul>
                        </li>
                        <li class="divider"></li>
                        <li class="dropdown-submenu">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">Mobile Phones</a>
                            <ul class="dropdown-menu">
                                 <li ><a href="#/search/SPRINT HARDWARE/Samsung">Samsung</a></li>
                                 <li class="divider"></li>
                                 <li><a href="#/search/SPRINT HARDWARE/Nokia">Nokia</a></li>
                                 <li class="divider"></li>
                                <li><a href="#/search/SPRINT HARDWARE/Blackberry">Blackberry</a></li>
                            </ul>
                        </li>
                        <li class="divider"></li>
                        <li class="dropdown-submenu">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">Microwaves</a>
                            <ul class="dropdown-menu">
                                <li><a href="#/search/MICROWAVE/Frigidaire">Frigidaire</a></li>
                                 <li class="divider"></li>
                                 <li><a href="#/search/MICROWAVE/Samsung">Samsung</a></li>
                                 <li class="divider"></li>
                                 <li><a href="#/search/MICROWAVE/LG">LG</a></li>
                                 <li class="divider"></li>
                                <li><a href="#/search/MICROWAVE/Panasonic">Panasonic</a></li>
                            </ul>
                        </li>
                        <li class="divider"></li>
                        <li class="dropdown-submenu">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">Washer and Dryers</a>
                            <ul class="dropdown-menu">
                                <li><a href="#/search/LAUNDRY/Whirlpool">Whirlpool</a></li>
                                 <li class="divider"></li>
                                 <li><a href="#/search/LAUNDRY/Samsung">Samsung</a></li>
                                 <li class="divider"></li>
                                 <li><a href="#/search/LAUNDRY/LG">LG</a></li>
                                 <li class="divider"></li>
                                <li><a href="#/search/LAUNDRY/GE">GE</a></li>
                            </ul>
                        </li>
                    </ul>
                </li>
                        <li id="favoritelink" ng-show="currentuser" ><a href="#/profile">My Account</a></li>
                    </ul>
                </div>
                <div id="navbar" class="navbar-collapse collapse">
                            
                            <ul class="nav navbar-nav navbar-right" ng-show="currentuser">
                                <li style="color:whitesmoke">Hello &nbsp;&nbsp;{{currentuser}}</li>
                                <li><a href="#/logout" ng-click="logout()">Logout</a></li>
                            </ul>
                            
                            <ul class="nav navbar-nav navbar-right" ng-show="!currentuser">
                        	<li id="registerlink"><a href="#/register"><span style="color:whitesmoke">Sign up</span></a></li>
                        	<li id="loginlink"><a href="#/login"><span style="color:whitesmoke">Login</span></a></li>
                        	</ul>

                </div><!--/.navbar-collapse -->
        </nav>
        <div ng-view>

        </div>
    	</div>
        </div>
        <h2>About the experiment</h2>
        <p id="text">
        	This experiment is about validating the registration form. As the user should not be allowed to submit the form
        	with invalid or blank values for mandatory fields, validating the form is necessary. The registration in this experiment
        	catches errors like choosing the username that already exists in the database, giving passwords that don't match with
        	each other, clearing the mandatory fields after giving some value and entering invalid email address. In case an error
        	occurs an error message is displayed right below the corresponding field. A directive is created to check if the username
        	already exists. The directive issues a call to the databse to check the given username against all the usernames in the 
        	database.
        	<br />
            <br />
            <b>Code Snippet:</b>
            <br />
            <br />
            <table class="code">
                <tr>
                    <td width="100%">
                        app.directive(&apos;uniqueUsername&apos;, [&apos;$http&apos;, function($http, $timeout) {  <br/>
	  return { <br/>
	    require: &apos;ngModel&apos;, <br/>
	    link: function(scope, elem, attrs, ctrl) { <br/>
	      scope.busy = false; <br/>
	      scope.$watch(attrs.ngModel, function(value) { <br/>
	        ctrl.$setValidity(&apos;isTaken&apos;, true); <br/>

	        if (!value) { <br/>
	          return; <br/>
	        } <br/>

	        $http.post(&apos;/user/checkUsername&apos;,{username:value}) <br/>
	        .success(function(data) { <br/>
	        	scope.busy = false; <br/>
	            
	          }) <br/>
	          .error(function(data) { <br/>

	            if (data.isTaken) { <br/>
	            		ctrl.$setValidity(&apos;isTaken&apos;, false); <br/>
	            } <br/>
	            scope.busy = false; <br/>
	          }); <br/>
	      }) <br/>
	    } <br/>
	  } <br/>
	}]); <br/>
                    </td>
                </tr>
            </table>
            <br/>
            The following directive is used to check if the passwords match each other.
            <br />
            <br />
            <b>Code Snippet:</b>
            <br />
            <br />
            <table class="code">
                <tr>
                    <td width="100%">
                    
                    	app.directive(&apos;match&apos;, [function () { <br/>
	  return { <br/>
	    require: &apos;ngModel&apos;, <br/>
	    link: function (scope, elem, attrs, ctrl) { <br/>
	      scope.$watch(&apos;[&apos; + attrs.ngModel + &apos;, &apos; + attrs.match + &apos;]&apos;, function(value){ <br/>
	        ctrl.$setValidity(&apos;match&apos;, value[0] === value[1] ); <br/>
	      }, true); <br/>
	    } <br/>
	  } <br/>
	}]); <br/>
                    
                    </td>
                </tr>
            </table>
        </p>
        <h2>Source Code</h2>
        <div><a href="https://github.com/visha-r/MongodbNodejs/blob/master/app.js" target="_blank">Server</a></div>
        <div><a href="https://github.com/visha-r/MongodbNodejs/blob/master/public/js/Expt11Controller.js" target="_blank">Controller </a></div>
        <div><a href="https://github.com/visha-r/MongodbNodejs/blob/master/public/js/NewProductService.js" target="_blank"> Angular Service</a></div>
        <h2>References</h2>
        <div><a href="https://github.com/zemirco/ng-signup-form/blob/master/app.js" target="_blank"> Github source </a></div>
    </div>
</body>
</html>